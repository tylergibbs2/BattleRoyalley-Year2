using Microsoft.Xna.Framework;
using StardewValley;

namespace BattleRoyale.Patches
{
    class FarmerInvulnerabilityTimer : Patch
    {
        // I always want to trigger that a farmer's invuln timer should decrease
        protected override PatchDescriptor GetPatchDescriptor() => new(typeof(Farmer), "MovePosition");

        public static void Postfix(GameTime time, ref Farmer __instance)
        {
            if (__instance.temporarilyInvincible)
            {
                __instance.temporaryInvincibilityTimer += time.ElapsedGameTime.Milliseconds;

                int invincibilityDuration = 1200;

                int multiplier = __instance.GetEffectsOfRingMultiplier(861);
                invincibilityDuration += 1000 * multiplier;

                if (__instance.temporaryInvincibilityTimer > invincibilityDuration)
                {
                    __instance.temporarilyInvincible = false;
                    __instance.temporaryInvincibilityTimer = 0;
                }
            }
        }
    }
}
